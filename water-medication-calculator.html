<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>饮水加药计算器</title>
<style>
:root {
    --default-label-width: 80px;
    --default-input-width: 80px;
    --vertical-label-font-size: 14px;
}

/* 公共样式 */
body {
    margin: 0;
    padding: 20px;
    background: #f0f8ff;
    font-family: Arial, Helvetica, sans-serif;
    min-height: 100vh;
    box-sizing: border-box;
}
.tabs {
    display: flex;
    border-bottom: 2px solid #0066cc;
    margin-bottom: 15px;
}
.tab {
    padding: 12px 28px;
    cursor: pointer;
    font-weight: bold;
    color: #0066cc;
    background: #e6f0ff;
    border: 1px solid #0066cc;
    border-bottom: none;
    margin-right: 4px;
}
.tab.active {
    background: #0066cc;
    color: #fff;
}
.tab-content { display: none; }
.tab-content.active { display: block; }
.container {
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
}
.diagram {
    position: relative;
    height: 700px;
    background: url('https://raw.githubusercontent.com/Vopell/wellhope/main/image.jpg') no-repeat center center;
    background-size: contain;
}
.input-group, .input-group-vertical, .env-group {
    position: absolute;
    font-size: 14px;
}
.input-group label, .input-group-vertical label {
    font-weight: bold;
}
.input-group input, .input-group select,
.input-group-vertical .input-wrapper input {
    height: 30px;
    padding: 4px 8px;
    border: 1px solid #999;
    border-radius: 4px;
    box-sizing: border-box;
}
.input-group .unit, .input-group-vertical .unit {
    font-weight: bold;
    color: #333;
    min-width: 40px;
}
input.enabled, select.enabled { background: #ffff99; }
input.disabled, select.disabled {
    background: #ffd6d6 !important;
    color: #666;
    pointer-events: none;
}
/* 桌面端布局位置 */
#box-water { --label-width: 100px; --input-width: 80px; top: 20%; left: 10%; }
#box-dispenser { --label-width: 100px; --input-width: 60px; top: 5%; left: 38%; }
#box-conc { --label-width: 110px; --input-width: 50px; top: 18%; right:56%; }
#box-dosage { --label-width: 90px; --input-width: 60px; top: 6%; right: 20%; }
#box-num { --label-width: 60px; --input-width: 80px; top: 45%; right: 13%; }
#box-weight { --label-width: 60px; --input-width: 80px; top: 52%; right: 13%; }

/* 重置按钮 */
.reset-btn {
    position: absolute;
    top: 2%;
    left: 7%;
    padding: 12px 28px;
    background: #ff8c00;
    color: #fff;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    z-index: 20;
}
.bucket-label {
    position: absolute;
    top: 60%;
    left: 30%;
    text-align: center;
    font-weight: bold;
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.5s ease, visibility 0.5s;
}
.bucket-label.visible {
    visibility: visible;
    opacity: 1;
}
.result {
    width: calc(100% - 40px);
    max-width: 1046px;
    margin: 0 auto;
    padding: 24px;
    background: rgba(0, 102, 204, 0.9);
    color: #fff;
    font-size: 24px;
    text-align: center;
    border-radius: 8px;
    box-sizing: border-box;
    position: absolute;
    left: 50%;
    bottom: 3px;
    transform: translateX(-50%);
    z-index: 15;
}

/* 移动端卡片式布局 */
.mobile-layout {
    display: none;
    flex-direction: column;
    gap: 16px;
    max-width: 480px;
    margin: 0 auto;
}
.mobile-card {
    background: #fff;
    padding: 16px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.mobile-card label {
    font-weight: bold;
}
.mobile-card input, .mobile-card select {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    border-radius: 6px;
    border: 1px solid #999;
    box-sizing: border-box;
}
.mobile-reset {
    margin-top: 10px;
    padding: 12px;
    font-size: 16px;
    border-radius: 30px;
    background: #ff8c00;
    color: #fff;
    border: none;
    cursor: pointer;
}
.mobile-result {
    padding: 16px;
    background: #0066cc;
    color: #fff;
    border-radius: 12px;
    font-size: 18px;
    text-align: center;
}

/* 自适应背景高度 */
@media(max-width:768px){
    .diagram, .container { height: auto; }
}
</style>
</head>
<body>

<div class="tabs">
    <div class="tab active" data-tab="sim">模拟</div>
    <div class="tab" data-tab="info">说明</div>
</div>

<div class="tab-content active" id="sim">

    <!-- 桌面端布局 -->
    <div class="container desktop-layout">
        <div class="diagram">
            <button class="reset-btn" onclick="resetAll()">清零</button>

            <div class="input-group-vertical" id="box-water">
                <label for="water">总耗水量</label>
                <div class="input-wrapper">
                    <input type="number" id="water" min="0" class="disabled">
                    <span class="unit">升/天</span>
                </div>
            </div>

            <div class="input-group-vertical" id="box-dispenser">
                <label for="dispenser">加药器设置</label>
                <div class="input-wrapper">
                    <input type="number" id="dispenser" min="0" max="100" step="0.1" class="disabled">
                    <span class="unit">%</span>
                </div>
            </div>

            <div class="input-group-vertical" id="box-conc">
                <label for="conc">产品有效浓度</label>
                <div class="input-wrapper">
                    <input type="number" id="conc" min="0" max="100" step="0.1" class="disabled">
                    <span class="unit">%</span>
                </div>
            </div>

            <div class="input-group-vertical" id="box-dosage">
                <label for="dosage">给药剂量</label>
                <div class="input-wrapper">
                    <input type="number" id="dosage" min="0" step="0.1" class="disabled">
                    <span class="unit">mg/kg</span>
                </div>
            </div>

            <div class="input-group" id="box-num">
                <label for="num">牲畜数量</label>
                <input type="number" id="num" min="1">
                <span class="unit">头</span>
            </div>

            <div class="input-group" id="box-weight">
                <label for="weight">平均体重</label>
                <input type="number" id="weight" min="0" step="0.1" class="disabled">
                <span class="unit">kg</span>
            </div>
        </div>
        <div class="result" id="result">请按顺序输入参数</div>
    </div>

    <!-- 移动端布局 -->
    <div class="mobile-layout" id="mobile-layout">

        <div class="mobile-card">
            <label>牲畜数量
                <input type="number" id="m-num" min="1">
            </label>
            <label>平均体重
                <input type="number" id="m-weight" min="0" step="0.1">
            </label>
            <label>总耗水量
                <input type="number" id="m-water" min="0">
            </label>
        </div>

        <div class="mobile-card">
            <label>加药器设置
                <input type="number" id="m-dispenser" min="0" max="100" step="0.1">
            </label>
            <label>产品有效浓度
                <input type="number" id="m-conc" min="0" max="100" step="0.1">
            </label>
            <label>给药剂量
                <input type="number" id="m-dosage" min="0" step="0.1">
            </label>
        </div>

        <div class="mobile-card">
            <label>温度
                <select id="m-temp">
                    <option value="normal">温度适中</option>
                    <option value="hot">炎热</option>
                </select>
            </label>
            <label>浪费水量
                <select id="m-waste">
                    <option value="none">无浪费</option>
                    <option value="low">低</option>
                    <option value="mid">中</option>
                    <option value="high">高</option>
                </select>
            </label>
        </div>

        <button class="mobile-reset" onclick="resetAllMobile()">清零</button>
        <div class="mobile-result" id="m-result">请按顺序输入参数</div>
    </div>

</div>

<div class="tab-content" id="info">
    <div class="instructions">
        该计算器用于计算通过加药器向饮水中加药时所需加入的药量。<br><br>
        计算原液使用量时，在相应的方格中输入数据，黄色背景表示可输入。<br><br>
        如果您不清楚畜群具体的饮水消耗量，可以只填写牲畜数量和平均活体重，系统会根据标准估算饮水量（可进一步通过“温度”和“浪费水量”选项调整估算值）。<br><br>
        根据第一天实际原液消耗量，即可反推真实饮水量并优化后续配药。
    </div>
</div>

<script>
function $(id){return document.getElementById(id);}

/* 桌面端输入 */
const inputs={num:$('num'),weight:$('weight'),water:$('water'),
dispenser:$('dispenser'),conc:$('conc'),dosage:$('dosage')};
const outputs={result:$('result')};

function setEnabled(el,enabled){
    el.disabled=!enabled;
    el.classList.toggle('enabled',enabled);
    el.classList.toggle('disabled',!enabled);
}
function resetAll(){
    Object.values(inputs).forEach(el=>{
        el.value='';setEnabled(el,false);
    });
    setEnabled(inputs.num,true);
    outputs.result.textContent='请按顺序输入参数';
}

/* 移动端输入 */
const mInputs={num:$('m-num'),weight:$('m-weight'),water:$('m-water'),
dispenser:$('m-dispenser'),conc:$('m-conc'),dosage:$('m-dosage'),
temp:$('m-temp'),waste:$('m-waste')};
const mResult=$('m-result');
function resetAllMobile(){
    Object.values(mInputs).forEach(el=>el.value='');
    mResult.textContent='请按顺序输入参数';
}

/* 计算逻辑 */
function calculateValues(num,weight,dosage,conc,water,dispenser){
    if(!num||!weight||!dosage||!conc||!water||!dispenser) return null;
    const productGr=Math.round(num*weight*dosage/(conc*10));
    const stockL=water*dispenser/100;
    return {productGr,stockL};
}
function updateDesktop(){
    const num=+inputs.num.value,weight=+inputs.weight.value,water=+inputs.water.value,
    dispenser=+inputs.dispenser.value,conc=+inputs.conc.value,dosage=+inputs.dosage.value;
    const res=calculateValues(num,weight,dosage,conc,water,dispenser);
    if(!res){outputs.result.textContent='请完整填写所有必要参数';return;}
    outputs.result.textContent=`生产一天所需原液 ${res.productGr} g 加入 ${res.stockL.toFixed(1)} l 稀释水`;
}
function updateMobile(){
    const num=+mInputs.num.value,weight=+mInputs.weight.value,water=+mInputs.water.value,
    dispenser=+mInputs.dispenser.value,conc=+mInputs.conc.value,dosage=+mInputs.dosage.value;
    const res=calculateValues(num,weight,dosage,conc,water,dispenser);
    if(!res){mResult.textContent='请完整填写所有必要参数';return;}
    mResult.textContent=`生产一天所需原液 ${res.productGr} g 加入 ${res.stockL.toFixed(1)} l 稀释水`;
}

/* 自动判断移动端显示 */
function checkMobile(){
    if(window.innerWidth<768){
        document.querySelector('.desktop-layout').style.display='none';
        document.getElementById('mobile-layout').style.display='flex';
    }else{
        document.querySelector('.desktop-layout').style.display='block';
        document.getElementById('mobile-layout').style.display='none';
    }
}
window.addEventListener('resize',checkMobile);
window.addEventListener('load',checkMobile);

/* 输入监听 */
['num','weight','water','dispenser','conc','dosage'].forEach(id=>{$(id).addEventListener('input',updateDesktop);});
['m-num','m-weight','m-water','m-dispenser','m-conc','m-dosage'].forEach(id=>{$(id).addEventListener('input',updateMobile);});

/* Tab切换 */
document.querySelectorAll('.tab').forEach(tab=>{
    tab.onclick=()=>{document.querySelectorAll('.tab, .tab-content').forEach(el=>el.classList.remove('active'));
    tab.classList.add('active');$(tab.dataset.tab).classList.add('active');};
});
</script>
</body>
</html>
