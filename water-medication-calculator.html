<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>é¥®æ°´åŠ è¯è®¡ç®—å™¨</title>
<style>
    :root {
        --pos-water-top: 20%;
        --pos-water-left: 6%;
        --pos-dispenser-top: 5%;
        --pos-dispenser-left: 38%;
        --pos-conc-top: 22%;
        --pos-conc-left: 35%;
        --pos-dosage-top: 35%;
        --pos-dosage-left: 35%;
        --pos-num-top: 48%;
        --pos-num-right: 12%;
        --pos-weight-top: 56%;
        --pos-weight-right: 12%;
        --pos-env-top: 33%;
        --pos-env-left: 8%;
        --default-label-width: 80px;
        --default-input-width: 80px;
        --vertical-label-font-size: 14px;
    }
    body {
        margin: 0;
        padding: 20px;
        background: #f0f8ff;
        font-family: Arial, Helvetica, sans-serif;
        min-height: 100vh;
        box-sizing: border-box;
    }
    .tabs {
        display: flex;
        border-bottom: 2px solid #0066cc;
        margin-bottom: 15px;
    }
    .tab {
        padding: 8px 25px;
        cursor: pointer;
        font-weight: bold;
        color: #0066cc;
        background: #e6f0ff;
        border: 2px solid #0066cc;
        border-radius: 20px;
        margin-right: 10px;
        transition: all 0.3s ease;
    }
    .tab.active {
        background: #0066cc;
        color: #fff;
        border-radius: 20px;
    }
    .tab:hover {
        background: #d0e4ff;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0,102,204,0.2);
    }
    .tab.active:hover {
        background: #0055aa;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .container {
        max-width: 1200px;
        margin: 0 auto;
        position: relative;
    }
    .diagram {
        position: relative;
        height: 700px;
        background: url('https://raw.githubusercontent.com/Vopell/wellhope/main/image.jpg') no-repeat center center;
        background-size: contain;
    }
    .input-group {
        position: absolute;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
    }
    .input-group label {
        font-weight: bold;
        white-space: nowrap;
        width: var(--label-width, var(--default-label-width));
    }
    .input-group input,
    .input-group select {
        width: var(--input-width, var(--default-input-width));
        height: 30px;
        padding: 4px 8px;
        font-size: 14px;
        border: 1px solid #999;
        border-radius: 4px;
        box-sizing: border-box;
    }
    .input-group .unit {
        font-weight: bold;
        color: #333;
        min-width: 40px;
    }
    .input-group-vertical {
        position: absolute;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    .input-group-vertical label {
        font-weight: bold;
        width: 100%;
        font-size: var(--vertical-label-font-size);
        margin-left: var(--vertical-label-offset, 0px);
    }
    .input-group-vertical .input-wrapper {
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: center;
    }
    .input-group-vertical .input-wrapper input {
        width: var(--input-width, var(--default-input-width));
        height: 30px;
        padding: 4px 8px;
        font-size: 14px;
        border: 1px solid #999;
        border-radius: 4px;
        box-sizing: border-box;
    }
    .input-group-vertical .input-wrapper .unit {
        font-weight: bold;
        color: #333;
        min-width: 40px;
    }
    input.enabled, select.enabled { background: #ffff99; }
    input.disabled, select.disabled {
        background: #ffd6d6 !important;
        color: #666;
        pointer-events: none;
    }
    .env-group {
        position: absolute;
        top: var(--pos-env-top);
        left: var(--pos-env-left);
        width: 160px;
        padding: 12px;
        background: #f9f9f9;
        border: 2px solid #aaa;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
        gap: 18px;
    }
    .env-group .input-group {
        position: static;
        margin: 0;
    }
    .env-group select {
        width: 120px;
    }
    #box-water { --label-width: 100px; --input-width: 80px; top: 20%; left: 10%; --vertical-label-offset: 15px; }
    #box-dispenser { --label-width: 100px; --input-width: 60px; top: var(--pos-dispenser-top); left: var(--pos-dispenser-left); --vertical-label-offset: -6px; }
    #box-conc { --label-width: 110px; --input-width: 50px; top: 18%; right:56%; --vertical-label-offset: -8px; }
    #box-dosage { --label-width: 90px; --input-width: 60px; top: 6%; right: 20%; }
    #box-num { --label-width: 60px; --input-width: 80px; top: 45%; right: 13%; }
    #box-weight { --label-width: 60px; --input-width: 80px; top: 52%; right: 13%; }
    .reset-btn {
        position: absolute;
        top: 2%;
        left: 7%;
        padding: 12px 28px;
        background: linear-gradient(135deg, #ffa500, #ff8c00);
        color: #fff;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        z-index: 20;
        box-shadow: 0 6px 18px rgba(255, 140, 0, 0.4);
        transition: all 0.3s ease;
        letter-spacing: 0.8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .reset-btn::before { content: "â†»"; font-size: 18px; }
    .reset-btn:hover { background: #e67e00; transform: translateY(-3px); box-shadow: 0 10px 25px rgba(255, 140, 0, 0.6); }
    .bucket-label {
        position: absolute;
        top: 60%;
        left: 30%;
        transform: translateY(-50%);
        text-align: center;
        font-weight: bold;
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.5s ease, visibility 0.5s;
    }
    .bucket-label.visible { visibility: visible; opacity: 1; }
    #product { font-size: 30px; color: #d00; margin-bottom: 50px; }
    #stock { font-size: 30px; color: #0066cc; }
    .result {
        width: calc(100% - 40px);
        max-width: 1046px;
        margin: 0 auto;
        padding: 24px;
        background: rgba(0, 102, 204, 0.9);
        color: #fff;
        font-size: 24px;
        text-align: center;
        border-radius: 8px;
        box-sizing: border-box;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        position: absolute;
        left: 50%;
        bottom: 3px;
        transform: translateX(-50%);
        z-index: 15;
    }
    .instructions {
        background: #fff;
        border: 1px solid #ccc;
        padding: 30px;
        line-height: 1.8;
        border-radius: 8px;
        font-size: 16px;
    }

    /* ==================== ç§»åŠ¨ç«¯åµŒå…¥å¼è¡¨å•æ ·å¼ ==================== */
    .mobile-embedded-form {
        display: none; /* æ¡Œé¢ç«¯éšè— */
        max-width: 500px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }
    .mobile-form-header {
        text-align: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #0066cc;
    }
    .mobile-form-header h2 {
        color: #0066cc;
        margin: 0 0 10px 0;
        font-size: 22px;
    }
    .mobile-form-header p {
        color: #666;
        font-size: 14px;
        margin: 0;
    }
    .mobile-form-group {
        margin-bottom: 20px;
    }
    .mobile-form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
        font-size: 16px;
    }
    .mobile-form-row {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .mobile-form-row input,
    .mobile-form-row select {
        flex: 1;
        height: 45px;
        padding: 0 12px;
        font-size: 16px;
        border: 2px solid #ddd;
        border-radius: 8px;
        box-sizing: border-box;
        transition: all 0.3s;
    }
    .mobile-form-row input:focus,
    .mobile-form-row select:focus {
        border-color: #0066cc;
        outline: none;
        box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
    }
    .mobile-form-row .unit {
        font-weight: bold;
        color: #333;
        min-width: 50px;
        font-size: 16px;
    }
    .mobile-form-actions {
        display: flex;
        gap: 15px;
        margin-top: 30px;
    }
    .mobile-form-btn {
        flex: 1;
        height: 60px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    .mobile-form-btn.primary {
        background: linear-gradient(135deg, #0066cc, #0055aa);
        color: white;
    }
    .mobile-form-btn.secondary {
        background: #f0f0f0;
        color: #333;
        border: 2px solid #ddd;
    }
    .mobile-form-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .mobile-result-panel {
        background: #0066cc;
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        text-align: center;
        font-size: 18px;
        line-height: 1.5;
    }
    .mobile-result-bucket {
        background: white;
        color: #333;
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
        display: flex;
        justify-content: space-around;
        align-items: center;
    }
    .mobile-bucket-item {
        text-align: center;
    }
    .mobile-bucket-value {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 5px;
    }
    .mobile-bucket-label {
        font-size: 14px;
        color: #666;
    }
    .mobile-bucket-value.product { color: #d00; }
    .mobile-bucket-value.stock { color: #0066cc; }

    /* ==================== ç§»åŠ¨ç«¯å“åº”å¼ ==================== */
    @media (max-width: 768px) {
        body { padding: 10px; }
        .diagram, .result { display: none; }
        .mobile-embedded-form { display: block; }
        .tabs { justify-content: center; flex-wrap: wrap; }
        .tab { padding: 10px 20px; margin: 0 5px 10px 5px; font-size: 15px; }
        .instructions { padding: 20px; font-size: 15px; line-height: 1.6; }
    }
    @media (max-width: 480px) {
        .mobile-embedded-form { padding: 20px; }
        .mobile-form-header h2 { font-size: 20px; }
        .mobile-form-group label { font-size: 15px; }
        .mobile-form-row input, .mobile-form-row select { height: 42px; font-size: 15px; }
        .mobile-form-actions { flex-direction: column; }
        .mobile-form-btn { height: 45px; }
    }
</style>
</head>
<body>
<div class="tabs">
    <div class="tab active" data-tab="sim">æ¨¡æ‹Ÿ</div>
    <div class="tab" data-tab="info">è¯´æ˜</div>
</div>

<!-- æ¡Œé¢ç«¯ç•Œé¢ -->
<div class="tab-content active" id="sim">
    <div class="container">
        <div class="diagram">
            <button class="reset-btn" onclick="resetAll()">æ¸…é›¶</button>
            <div class="input-group-vertical" id="box-water">
                <label for="water">æ€»è€—æ°´é‡</label>
                <div class="input-wrapper">
                    <input type="number" id="water" min="0" class="disabled" inputmode="decimal">
                    <span class="unit">å‡/å¤©</span>
                </div>
            </div>
            <div class="env-group" id="env-group">
                <div class="input-group">
                    <label for="temp">æ¸©åº¦</label>
                    <select id="temp">
                        <option value="normal">æ¸©åº¦é€‚ä¸­</option>
                        <option value="hot">ç‚çƒ­</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="waste">æµªè´¹æ°´é‡</label>
                    <select id="waste">
                        <option value="none">æ— æµªè´¹</option>
                        <option value="low">ä½</option>
                        <option value="mid">ä¸­</option>
                        <option value="high">é«˜</option>
                    </select>
                </div>
            </div>
            <div class="input-group-vertical" id="box-dispenser">
                <label for="dispenser">åŠ è¯å™¨è®¾ç½®</label>
                <div class="input-wrapper">
                    <input type="number" id="dispenser" min="0" max="100" step="0.1" class="disabled" inputmode="decimal">
                    <span class="unit">%</span>
                </div>
            </div>
            <div class="input-group-vertical" id="box-conc">
                <label for="conc">äº§å“æœ‰æ•ˆæµ“åº¦</label>
                <div class="input-wrapper">
                    <input type="number" id="conc" min="0" max="100" step="0.1" class="disabled" inputmode="decimal">
                    <span class="unit">%</span>
                </div>
            </div>
            <div class="input-group-vertical" id="box-dosage">
                <label for="dosage">ç»™è¯å‰‚é‡</label>
                <div class="input-wrapper">
                    <input type="number" id="dosage" min="0" step="0.1" class="disabled" inputmode="decimal">
                    <span class="unit">mg/kg</span>
                </div>
            </div>
            <div class="input-group" id="box-num">
                <label for="num">ç‰²ç•œæ•°é‡</label>
                <input type="number" id="num" min="1" inputmode="numeric">
                <span class="unit">å¤´</span>
            </div>
            <div class="input-group" id="box-weight">
                <label for="weight">å¹³å‡ä½“é‡</label>
                <input type="number" id="weight" min="0" step="0.1" class="disabled" inputmode="decimal">
                <span class="unit">kg</span>
            </div>
            <div class="bucket-label" id="bucket-label">
                <div id="product"></div>
                <div id="stock"></div>
            </div>
        </div>
        <div class="result" id="result">è¯·æŒ‰é¡ºåºè¾“å…¥å‚æ•°</div>
    </div>

    <!-- ç§»åŠ¨ç«¯åµŒå…¥å¼è¡¨å• -->
    <div class="mobile-embedded-form">
        <div class="mobile-form-group">
            <label for="mobile-num">ç‰²ç•œæ•°é‡</label>
            <div class="mobile-form-row">
                <input type="number" id="mobile-num" min="1" inputmode="numeric" placeholder="ä¾‹å¦‚ï¼š100">
                <span class="unit">å¤´</span>
            </div>
        </div>

        <div class="mobile-form-group">
            <label for="mobile-weight">å¹³å‡ä½“é‡</label>
            <div class="mobile-form-row">
                <input type="number" id="mobile-weight" min="0" step="0.1" inputmode="decimal" placeholder="ä¾‹å¦‚ï¼š50.5" disabled>
                <span class="unit">kg</span>
            </div>
        </div>

        <div class="mobile-form-group">
            <label for="mobile-dosage">ç»™è¯å‰‚é‡</label>
            <div class="mobile-form-row">
                <input type="number" id="mobile-dosage" min="0" step="0.1" inputmode="decimal" placeholder="ä¾‹å¦‚ï¼š10" disabled>
                <span class="unit">mg/kg</span>
            </div>
        </div>

        <div class="mobile-form-group">
            <label for="mobile-conc">äº§å“æœ‰æ•ˆæµ“åº¦</label>
            <div class="mobile-form-row">
                <input type="number" id="mobile-conc" min="0" max="100" step="0.1" inputmode="decimal" placeholder="ä¾‹å¦‚ï¼š10" disabled>
                <span class="unit">%</span>
            </div>
        </div>

        <div class="mobile-form-group">
            <label for="mobile-dispenser">åŠ è¯å™¨è®¾ç½®</label>
            <div class="mobile-form-row">
                <input type="number" id="mobile-dispenser" min="0" max="100" step="0.1" inputmode="decimal" placeholder="ä¾‹å¦‚ï¼š5" disabled>
                <span class="unit">%</span>
            </div>
        </div>

        <div class="mobile-form-group">
            <label for="mobile-water">æ€»è€—æ°´é‡</label>
            <div class="mobile-form-row">
                <input type="number" id="mobile-water" min="0" inputmode="decimal" placeholder="è‡ªåŠ¨è®¡ç®—" disabled>
                <span class="unit">å‡/å¤©</span>
            </div>
        </div>

        <div class="mobile-form-group">
            <label for="mobile-temp">æ¸©åº¦</label>
            <div class="mobile-form-row">
                <select id="mobile-temp" disabled>
                    <option value="normal">æ¸©åº¦é€‚ä¸­</option>
                    <option value="hot">ç‚çƒ­</option>
                </select>
            </div>
        </div>

        <div class="mobile-form-group">
            <label for="mobile-waste">æµªè´¹æ°´é‡</label>
            <div class="mobile-form-row">
                <select id="mobile-waste" disabled>
                    <option value="none">æ— æµªè´¹</option>
                    <option value="low">ä½</option>
                    <option value="mid">ä¸­</option>
                    <option value="high">é«˜</option>
                </select>
            </div>
        </div>

        <div class="mobile-result-panel" id="mobile-result-panel">
            <div id="mobile-result-text">è¯·å®Œæ•´å¡«å†™æ‰€æœ‰å‚æ•°</div>
            <div class="mobile-result-bucket" id="mobile-result-bucket" style="display: none;">
                <div class="mobile-bucket-item">
                    <div class="mobile-bucket-value product" id="mobile-product">0 g</div>
                    <div class="mobile-bucket-label">å•†ä¸šè¯å“</div>
                </div>
                <div class="mobile-bucket-item">
                    <div class="mobile-bucket-value stock" id="mobile-stock">0 L</div>
                    <div class="mobile-bucket-label">ç¨€é‡Šç”¨æ°´</div>
                </div>
            </div>
        </div>

        <div class="mobile-form-actions">
            <button class="mobile-form-btn secondary" id="mobile-reset-btn">
                <span>â†»</span> é‡ç½®
            </button>
            <button class="mobile-form-btn primary" id="mobile-calculate-btn">
                <span>ğŸ“Š</span> è®¡ç®—
            </button>
        </div>
    </div>
</div>

<div class="tab-content" id="info">
    <div class="instructions">
        è¯¥è®¡ç®—å™¨ç”¨äºè®¡ç®—é€šè¿‡åŠ è¯å™¨å‘é¥®æ°´ä¸­åŠ è¯æ—¶æ‰€éœ€åŠ å…¥çš„è¯é‡ã€‚<br><br>
        è®¡ç®—åŸæ¶²ä½¿ç”¨é‡æ—¶ï¼Œåœ¨ç›¸åº”çš„æ–¹æ ¼ä¸­è¾“å…¥æ•°æ®ï¼Œé»„è‰²èƒŒæ™¯è¡¨ç¤ºå¯è¾“å…¥ã€‚<br><br>
        å¦‚æœæ‚¨ä¸æ¸…æ¥šç•œç¾¤å…·ä½“çš„é¥®æ°´æ¶ˆè€—é‡ï¼Œå¯ä»¥åªå¡«å†™ç‰²ç•œæ•°é‡å’Œå¹³å‡æ´»ä½“é‡ï¼Œç³»ç»Ÿä¼šæ ¹æ®æ ‡å‡†ä¼°ç®—é¥®æ°´é‡ï¼ˆå¯è¿›ä¸€æ­¥é€šè¿‡"æ¸©åº¦"å’Œ"æµªè´¹æ°´é‡"é€‰é¡¹è°ƒæ•´ä¼°ç®—å€¼ï¼‰ã€‚<br><br>
        æ ¹æ®ç¬¬ä¸€å¤©å®é™…åŸæ¶²æ¶ˆè€—é‡ï¼Œå³å¯åæ¨çœŸå®é¥®æ°´é‡å¹¶ä¼˜åŒ–åç»­é…è¯ã€‚
    </div>
</div>

<script>
    const $ = id => document.getElementById(id);

    // ==================== ç»Ÿä¸€é…ç½®ï¼šåŒºåˆ†æ¡Œé¢/ç§»åŠ¨ ====================
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) 
                     || window.innerWidth <= 768;

    // è¾“å…¥å…ƒç´ ï¼ˆæ¡Œé¢ vs ç§»åŠ¨ï¼‰
    const inputs = {
        num:        isMobile ? $('mobile-num')       : $('num'),
        weight:     isMobile ? $('mobile-weight')    : $('weight'),
        water:      isMobile ? $('mobile-water')     : $('water'),
        temp:       isMobile ? $('mobile-temp')      : $('temp'),
        waste:      isMobile ? $('mobile-waste')     : $('waste'),
        dispenser:  isMobile ? $('mobile-dispenser') : $('dispenser'),
        conc:       isMobile ? $('mobile-conc')      : $('conc'),
        dosage:     isMobile ? $('mobile-dosage')    : $('dosage')
    };

    // è¾“å‡ºå…ƒç´ 
    const outputs = {
        product:    isMobile ? $('mobile-product')   : $('product'),
        stock:      isMobile ? $('mobile-stock')     : $('stock'),
        resultText: isMobile ? $('mobile-result-text') : $('result'),
        bucketContainer: isMobile ? $('mobile-result-bucket') : $('bucket-label'),
        resultPanel: isMobile ? $('mobile-result-panel') : null  // æ¡Œé¢æ— æ­¤å®¹å™¨
    };

    // å…¶ä»– UI å…ƒç´ ï¼ˆä»…ç§»åŠ¨ç«¯æœ‰æŒ‰é’®ï¼Œæ¡Œé¢æœ‰ç¯å¢ƒç»„å’Œæ¸…é›¶æŒ‰é’®ï¼‰
    const ui = {
        envGroup:   $('env-group'),
        resetBtn:   isMobile ? $('mobile-reset-btn') : $('reset-btn'),
        calcBtn:    isMobile ? $('mobile-calculate-btn') : null
    };

    // ==================== å…±äº«å·¥å…·å‡½æ•° ====================
    function setEnabled(el, enabled) {
        if (!el) return;
        el.disabled = !enabled;
        if (enabled) {
            el.classList.remove('disabled');
            el.classList.add('enabled');
            if (isMobile) el.style.backgroundColor = '#ffff99';
        } else {
            el.classList.remove('enabled');
            el.classList.add('disabled');
            if (isMobile) el.style.backgroundColor = '#ffd6d6';
        }
    }

    function clearInputs() {
        Object.values(inputs).forEach(el => {
            if (el && el.tagName === 'SELECT') el.selectedIndex = 0;
            else if (el) el.value = '';
        });
    }

    function resetAll() {
        clearInputs();
        Object.values(inputs).forEach(el => el && setEnabled(el, false));
        setEnabled(inputs.num, true);

        if (outputs.product) outputs.product.textContent = '';
        if (outputs.stock) outputs.stock.textContent = '';
        if (outputs.resultText) outputs.resultText.textContent = isMobile ? 'è¯·å®Œæ•´å¡«å†™æ‰€æœ‰å‚æ•°' : 'è¯·æŒ‰é¡ºåºè¾“å…¥å‚æ•°';
        if (outputs.bucketContainer) outputs.bucketContainer.style.display = 'none';
        if (outputs.bucketContainer && !isMobile) outputs.bucketContainer.classList.remove('visible');
        if (ui.envGroup) ui.envGroup.style.display = 'none';
        if (outputs.resultPanel) outputs.resultPanel.style.display = 'none';
    }

    // è¾“å…¥åªèƒ½æ˜¯æ•°å­—å’Œå°æ•°ç‚¹
    function addNumericFilter(el) {
        if (!el) return;
        el.addEventListener('input', function () {
            this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\./g, '$1');
        });
    }

    // ä¼°ç®—æ¯æ—¥é¥®æ°´é‡ï¼ˆLï¼‰
    function estimateWater() {
        if (!inputs.num.value || !inputs.weight.value) return;

        let base = inputs.num.value * inputs.weight.value * 0.1; // æ ‡å‡†ï¼šä½“é‡ kg çš„ 10%
        if (inputs.temp.value === 'hot') base *= 1.5;

        switch (inputs.waste.value) {
            case 'low':  base *= 1.1; break;
            case 'mid':  base *= 1.2; break;
            case 'high': base *= 1.4; break;
        }

        inputs.water.value = Math.round(base);
        calculate();
    }

    // æ ¸å¿ƒè®¡ç®—
    let calcTimeout;
    function calculate() {
        clearTimeout(calcTimeout);
        calcTimeout = setTimeout(() => {
            const v = {
                num:       +inputs.num.value       || 0,
                weight:    +inputs.weight.value    || 0,
                dosage:    +inputs.dosage.value    || 0,
                conc:      +inputs.conc.value      || 0,
                water:     +inputs.water.value     || 0,
                dispenser: +inputs.dispenser.value || 0
            };

            const allFilled = v.num > 0 && v.weight > 0 && v.dosage > 0 && 
                              v.conc > 0 && v.water > 0 && v.dispenser > 0;

            if (!allFilled) {
                if (outputs.resultText) {
                    outputs.resultText.textContent = isMobile ? 'è¯·å®Œæ•´å¡«å†™æ‰€æœ‰å¿…è¦å‚æ•°' : 'è¯·å®Œæ•´å¡«å†™æ‰€æœ‰å¿…è¦å‚æ•°';
                }
                if (outputs.bucketContainer) outputs.bucketContainer.style.display = 'none';
                if (!isMobile && outputs.bucketContainer) outputs.bucketContainer.classList.remove('visible');
                return;
            }

            const productGr = Math.round(v.num * v.weight * v.dosage / (v.conc * 10));
            const stockL = v.water * v.dispenser / 100;
            const stockDisplay = stockL % 1 === 0 ? stockL.toFixed(0) : stockL.toFixed(1);

            if (outputs.product) outputs.product.textContent = productGr + ' g';
            if (outputs.stock) outputs.stock.textContent = stockDisplay + (isMobile ? ' l' : ' l');

            if (outputs.resultText) {
                outputs.resultText.textContent = `ç”Ÿäº§ä¸€å¤©æ‰€éœ€çš„åŸæ¶²æˆ‘ä»¬éœ€è¦å°† ${productGr} g æˆ– ml çš„å•†ä¸šè¯å“åŠ å…¥åˆ° ${stockDisplay} l çš„ç¨€é‡Šç”¨æ°´ä¸­ã€‚`;
            }

            // æ˜¾ç¤ºç»“æœå®¹å™¨
            if (outputs.bucketContainer) {
                outputs.bucketContainer.style.display = isMobile ? 'flex' : 'block';
                if (!isMobile) outputs.bucketContainer.classList.add('visible');
            }
            if (outputs.resultPanel) outputs.resultPanel.style.display = 'block';
        }, 300);
    }

    // ==================== åˆå§‹åŒ–ä¸äº‹ä»¶ç»‘å®š ====================
    function initApp() {
        // é‡ç½®æŒ‰é’®
        if (ui.resetBtn) ui.resetBtn.addEventListener('click', resetAll);

        // æ•°å­—è¾“å…¥è¿‡æ»¤
        ['num', 'weight', 'water', 'dispenser', 'conc', 'dosage'].forEach(key => {
            addNumericFilter(inputs[key]);
        });

        // ç‰²ç•œæ•°é‡ â†’ å¯ç”¨å¹³å‡ä½“é‡
        inputs.num.addEventListener('input', () => {
            const hasValue = inputs.num.value > 0;
            setEnabled(inputs.weight, hasValue);
            if (hasValue && inputs.weight.value > 0) estimateWater();
        });

        // å¹³å‡ä½“é‡ â†’ å¯ç”¨åç»­æ‰€æœ‰è¾“å…¥ + æ˜¾ç¤ºç¯å¢ƒç»„ï¼ˆæ¡Œé¢ï¼‰
        inputs.weight.addEventListener('input', () => {
            const hasValue = inputs.weight.value > 0;
            setEnabled(inputs.dosage, hasValue);
            setEnabled(inputs.conc, hasValue);
            setEnabled(inputs.dispenser, hasValue);
            setEnabled(inputs.temp, hasValue);
            setEnabled(inputs.waste, hasValue);

            if (hasValue && ui.envGroup) ui.envGroup.style.display = 'block';

            if (hasValue) estimateWater();
        });

        // ç¯å¢ƒå› ç´ æ”¹å˜ â†’ é‡æ–°ä¼°ç®—é¥®æ°´é‡
        inputs.temp.addEventListener('change', estimateWater);
        inputs.waste.addEventListener('change', estimateWater);

        // å…³é”®å‚æ•°è¾“å…¥ â†’ å®æ—¶è®¡ç®—
        [inputs.water, inputs.dispenser, inputs.conc, inputs.dosage].forEach(el => {
            if (el) el.addEventListener('input', calculate);
        });

        // ç§»åŠ¨ç«¯ä¸“æœ‰ï¼šç‚¹å‡»â€œè®¡ç®—â€æŒ‰é’®
        if (ui.calcBtn) ui.calcBtn.addEventListener('click', calculate);

        // åˆå§‹çŠ¶æ€
        resetAll();
    }

    // æ ‡ç­¾é¡µåˆ‡æ¢ï¼ˆä¿æŒåŸæ ·ï¼‰
    document.querySelectorAll('.tab').forEach(tab => {
        tab.onclick = () => {
            document.querySelectorAll('.tab, .tab-content').forEach(el => el.classList.remove('active'));
            tab.classList.add('active');
            $(tab.dataset.tab).classList.add('active');
        };
    });

    document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>
