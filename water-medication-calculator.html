<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>饮水加药计算器</title>
<style>
    :root {
        --pos-water-top: 20%;
        --pos-water-left: 6%;
        --pos-dispenser-top: 5%;
        --pos-dispenser-left: 38%;
        --pos-conc-top: 22%;
        --pos-conc-left: 35%;
        --pos-dosage-top: 35%;
        --pos-dosage-left: 35%;
        --pos-num-top: 48%;
        --pos-num-right: 12%;
        --pos-weight-top: 56%;
        --pos-weight-right: 12%;
        --pos-env-top: 33%;
        --pos-env-left: 8%;

        /* 默认宽度 */
        --default-label-width: 80px;
        --default-input-width: 80px;

        /* 垂直标签字体大小自定义 */
        --vertical-label-font-size: 14px;
    }
    body {
        margin: 0;
        padding: 20px;
        background: #f0f8ff;
        font-family: Arial, Helvetica, sans-serif;
        min-height: 100vh;
        box-sizing: border-box;
    }
    .tabs {
        display: flex;
        border-bottom: 2px solid #0066cc;
        margin-bottom: 15px;
    }
	.tab {
		padding: 8px 25px;           /* 略增大内边距，让按钮更大气 */
		cursor: pointer;
		font-weight: bold;
		color: #0066cc;
		background: #e6f0ff;
		border: 2px solid #0066cc;    /* 加粗边框，更突出 */
		border-radius: 20px;          /* === 关键：大圆角，实现圆润胶囊效果 === */
		margin-right: 10px;           /* 按钮间距稍大 */
		transition: all 0.3s ease;    /* 添加平滑过渡动画 */
	}

	.tab.active {
		background: #0066cc;
		color: #fff;
		border-radius: 20px;          /* 激活状态也保持圆润 */
	}

	.tab:hover {
		background: #d0e4ff;          /* 悬停时浅色反馈 */
		transform: translateY(-2px);  /* 轻微上浮，更有立体感 */
		box-shadow: 0 4px 10px rgba(0,102,204,0.2);
	}

	.tab.active:hover {
		background: #0055aa;          /* 激活状态悬停稍深色 */
	}
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .container {
        max-width: 1200px;
        margin: 0 auto;
        position: relative;
    }
    .diagram {
        position: relative;
        height: 700px;
        background: url('https://raw.githubusercontent.com/Vopell/wellhope/main/image.jpg') no-repeat center center;
        background-size: contain;
    }

    /* 横向输入组（通用，包括环境因素） */
    .input-group {
        position: absolute;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
    }
    .input-group label {
        font-weight: bold;
        white-space: nowrap;
        width: var(--label-width, var(--default-label-width));
    }
    .input-group input,
    .input-group select {
        width: var(--input-width, var(--default-input-width));
        height: 30px;
        padding: 4px 8px;
        font-size: 14px;
        border: 1px solid #999;
        border-radius: 4px;
        box-sizing: border-box;
    }
    .input-group .unit {
        font-weight: bold;
        color: #333;
        min-width: 40px;
    }

    /* 垂直输入组（总耗水量、加药器、浓度、剂量） */
    .input-group-vertical {
        position: absolute;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    .input-group-vertical label {
        font-weight: bold;
        width: 100%;
		font-size: var(--vertical-label-font-size);
		margin-left: var(--vertical-label-offset, 0px);  /* 单独微调标签 */
    }
    .input-group-vertical .input-wrapper {
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: center;
    }
    .input-group-vertical .input-wrapper input {
        width: var(--input-width, var(--default-input-width));
        height: 30px;
        padding: 4px 8px;
        font-size: 14px;
        border: 1px solid #999;
        border-radius: 4px;
        box-sizing: border-box;
    }
    .input-group-vertical .input-wrapper .unit {
        font-weight: bold;
        color: #333;
        min-width: 40px;
    }

    input.enabled, select.enabled { background: #ffff99; }
    input.disabled, select.disabled {
        background: #ffd6d6 !important;
        color: #666;
        pointer-events: none;
    }

    /* 环境因素面板 - 使用横向布局 */
    .env-group {
        position: absolute;
        top: var(--pos-env-top);
        left: var(--pos-env-left);
        width: 160px;                 /* 适当加宽以容纳横向布局 */
        padding: 12px;
        background: #f9f9f9;
        border: 2px solid #aaa;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        display: none;
        display: flex;                 /* 改为 flex 横向排列两个选项 */
        flex-direction: column;
        gap: 18px;
    }
    .env-group .input-group {
        position: static;
        margin: 0;
    }
	.env-group select {
        width: 120px; /* 下拉框宽度固定，更美观 */
    }
    /* 输入框位置 */
    #box-water { --label-width: 100px; --input-width: 80px; top: 20%; left: 10%;--vertical-label-offset: 15px; }
    #box-dispenser { --label-width: 100px; --input-width: 60px; top: var(--pos-dispenser-top); left: var(--pos-dispenser-left); --vertical-label-offset: -6px}
    #box-conc { --label-width: 110px; --input-width: 50px; top: 18%; right:56%;--vertical-label-offset: -8px; }
    #box-dosage { --label-width: 90px; --input-width: 60px; top: 6%; right: 20%; }
    #box-num { --label-width: 60px; --input-width: 80px; top: 45%; right: 13%; }
    #box-weight { --label-width: 60px; --input-width: 80px; top: 52%; right: 13%; }

	.reset-btn {
		position: absolute;
		top: 2%;
		left: 7%;
		padding: 12px 28px;                    /* 舒适内边距 */
		background: linear-gradient(135deg, #ffa500, #ff8c00);                
		color: #fff;                           /* 白色文字，高对比 */
		border: none;
		border-radius: 30px;                   /* 胶囊圆角 */
		cursor: pointer;
		font-size: 16px;
		font-weight: bold;
		z-index: 20;
		box-shadow: 0 6px 18px rgba(255, 140, 0, 0.4); /* 橙色阴影，立体突出 */
		transition: all 0.3s ease;
		letter-spacing: 0.8px;
		display: flex;                         /* 新增：flex布局容纳图标 */
		align-items: center;
		gap: 8px;                              /* 图标与文字间距 */
	}

	.reset-btn::before {
		content: "↻";                          /* 刷新图标 */
		font-size: 18px;                       /* 图标稍大 */
		display: inline-block;
	}

	.reset-btn:hover {
		background: #e67e00;                   /* 悬停稍深橙 */
		transform: translateY(-3px);
		box-shadow: 0 10px 25px rgba(255, 140, 0, 0.6);
	}

	.reset-btn:active {
		transform: translateY(-1px);
	}
    .bucket-label {
        position: absolute;
        top: 60%;
        left: 30%;
		transform: translateY(-50%);
        text-align: center;
        font-weight: bold;
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.5s ease, visibility 0.5s;
    }
    .bucket-label.visible {
        visibility: visible;
        opacity: 1;
    }
    #product {
        font-size: 30px;
        color: #d00;
        margin-bottom: 50px;
    }
    #stock {
        font-size: 30px;
        color: #0066cc;
    }

	.result {
		width: calc(100% - 40px);     /* 与 body padding 一致，左右各留20px间隙 */
		max-width: 1046px;            /* 与 .container 一致，确保不超过背景图最大宽度 */
		margin: 0 auto;               /* 水平居中 */
		padding: 24px;
		background: rgba(0, 102, 204, 0.9);
		color: #fff;
		font-size: 24px;
		text-align: center;
		border-radius: 8px;
		box-sizing: border-box;
		box-shadow: 0 4px 20px rgba(0,0,0,0.3);

		/* 关键：浮动在图片上方 */
		position: absolute;
		left: 50%;                    /* 从中心开始 */
		bottom: 3px;                 /* 距离图片底部20px（可调整为30px、40px等） */
		transform: translateX(-50%);  /* 精确水平居中 */
		z-index: 15;                  /* 高于图片 */
	}

    .instructions {
        background: #fff;
        border: 1px solid #ccc;
        padding: 30px;
        line-height: 1.8;
        border-radius: 8px;
        font-size: 16px;
    }

/* === 仅在移动端修正绝对定位偏移 === */
@media (max-width: 768px) {
    /* 所有绝对定位的输入框在手机端居中并适当缩小，避免跑出屏幕 */
    .input-group,
    .input-group-vertical,
    .env-group {
        transform: scale(0.85);           /* 整体缩小15%，防止溢出 */
        transform-origin: top left;       /* 从左上角缩放，避免右边偏移 */
    }

    /* 针对每个绝对定位框，强制拉回屏幕内并微调位置 */
    #box-water {
        top: 15% !important;
        left: 5% !important;
    }
    #box-dispenser {
        top: 5% !important;
        left: 35% !important;
    }
    #box-conc {
        top: 20% !important;
        left: 35% !important;
    }
    #box-dosage {
        top: 35% !important;
        right: 15% !important;
    }
    #box-num {
        top: 50% !important;
        right: 10% !important;
    }
    #box-weight {
        top: 60% !important;
        right: 10% !important;
    }
    .env-group {
        top: 35% !important;
        left: 5% !important;
    }

    /* 清零按钮在手机端左上角固定，不偏移 */
    .reset-btn {
        top: 5px !important;
        left: 5px !important;
        padding: 10px 18px !important;
        font-size: 14px !important;
    }

    /* 结果框在手机端向上提，避免被键盘或底部遮挡 */
    .result {
        bottom: 10px !important;
        font-size: 20px !important;
        padding: 18px !important;
        max-width: calc(100% - 20px) !important;
    }

    /* 母液桶显示在手机端向上移 */
    .bucket-label {
        top: 55% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
    }
}
</style>
</head>
<body>
<div class="tabs">
    <div class="tab active" data-tab="sim">模拟</div>
    <div class="tab" data-tab="info">说明</div>
</div>

<div class="tab-content active" id="sim">
    <div class="container">
        <div class="diagram">
            <button class="reset-btn" onclick="resetAll()">清零</button>

            <!-- 总耗水量 -->
            <div class="input-group-vertical" id="box-water">
                <label for="water">总耗水量</label>
                <div class="input-wrapper">
                    <input type="number" id="water" min="0" class="disabled">
                    <span class="unit">升/天</span>
                </div>
            </div>

            <!-- 环境因素面板：标签与下拉框平行显示 -->
            <div class="env-group" id="env-group">
                <div class="input-group">
                    <label for="temp">温度</label>
                    <select id="temp">
                        <option value="normal">温度适中</option>
                        <option value="hot">炎热</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="waste">浪费水量</label>
                    <select id="waste">
                        <option value="none">无浪费</option>
                        <option value="low">低</option>
                        <option value="mid">中</option>
                        <option value="high">高</option>
                    </select>
                </div>
            </div>

            <!-- 加药器设置 -->
            <div class="input-group-vertical" id="box-dispenser">
                <label for="dispenser">加药器设置</label>
                <div class="input-wrapper">
                    <input type="number" id="dispenser" min="0" max="100" step="0.1" class="disabled">
                    <span class="unit">%</span>
                </div>
            </div>

            <!-- 产品有效浓度 -->
            <div class="input-group-vertical" id="box-conc">
                <label for="conc">产品有效浓度</label>
                <div class="input-wrapper">
                    <input type="number" id="conc" min="0" max="100" step="0.1" class="disabled">
                    <span class="unit">%</span>
                </div>
            </div>

            <!-- 给药剂量 -->
            <div class="input-group-vertical" id="box-dosage">
                <label for="dosage">给药剂量</label>
                <div class="input-wrapper">
                    <input type="number" id="dosage" min="0" step="0.1" class="disabled">
                    <span class="unit">mg/kg</span>
                </div>
            </div>

            <!-- 牲畜数量 -->
            <div class="input-group" id="box-num">
                <label for="num">牲畜数量</label>
                <input type="number" id="num" min="1">
                <span class="unit">头</span>
            </div>

            <!-- 平均体重 -->
            <div class="input-group" id="box-weight">
                <label for="weight">平均体重</label>
                <input type="number" id="weight" min="0" step="0.1" class="disabled">
                <span class="unit">kg</span>
            </div>

            <!-- 母液桶显示 -->
            <div class="bucket-label" id="bucket-label">
                <div id="product"></div>
                <div id="stock"></div>
            </div>
        </div>

        <div class="result" id="result">请按顺序输入参数</div>
    </div>
</div>

<div class="tab-content" id="info">
    <div class="instructions">
        该计算器用于计算通过加药器向饮水中加药时所需加入的药量。<br><br>
        计算原液使用量时，在相应的方格中输入数据，黄色背景表示可输入。<br><br>
        如果您不清楚畜群具体的饮水消耗量，可以只填写牲畜数量和平均活体重，系统会根据标准估算饮水量（可进一步通过“温度”和“浪费水量”选项调整估算值）。<br><br>
        根据第一天实际原液消耗量，即可反推真实饮水量并优化后续配药。
    </div>
</div>

<script>
    const $ = id => document.getElementById(id);
    const inputs = {
        num: $('num'),
        weight: $('weight'),
        water: $('water'),
        temp: $('temp'),
        waste: $('waste'),
        dispenser: $('dispenser'),
        conc: $('conc'),
        dosage: $('dosage')
    };
    const outputs = {
        product: $('product'),
        stock: $('stock'),
        result: $('result'),
        bucketLabel: $('bucket-label')
    };

    function setEnabled(el, enabled) {
        el.disabled = !enabled;
        if (enabled) {
            el.classList.remove('disabled');
            el.classList.add('enabled');
        } else {
            el.classList.remove('enabled');
            el.classList.add('disabled');
        }
    }

    function resetAll() {
        Object.values(inputs).forEach(el => {
            if (el.tagName === 'SELECT') {
                el.selectedIndex = 0;
            } else {
                el.value = '';
            }
            setEnabled(el, false);
        });
        setEnabled(inputs.num, true);
        $('env-group').style.display = 'none';
        outputs.product.textContent = '';
        outputs.stock.textContent = '';
        if (outputs.bucketLabel) outputs.bucketLabel.classList.remove('visible');
        outputs.result.textContent = '请按顺序输入参数';
    }

    ['num', 'weight', 'water', 'dispenser', 'conc', 'dosage'].forEach(key => {
        inputs[key].addEventListener('input', function () {
            this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\./g, '$1');
        });
    });

	inputs.num.addEventListener('input', () => {
		setEnabled(inputs.weight, inputs.num.value > 0);
		if (inputs.weight.value > 0) {
			estimateWater();
		}
	});

    inputs.weight.addEventListener('input', () => {
        if (inputs.weight.value > 0) {
            [inputs.water, inputs.dispenser, inputs.conc, inputs.dosage].forEach(el => setEnabled(el, true));
            $('env-group').style.display = 'block';
            setEnabled(inputs.temp, true);
            setEnabled(inputs.waste, true);
            inputs.temp.selectedIndex = 0;
            inputs.waste.selectedIndex = 0;
            estimateWater();
        }
    });

    inputs.temp.addEventListener('change', () => { estimateWater(); calculate(); });
    inputs.waste.addEventListener('change', () => { estimateWater(); calculate(); });

    [inputs.water, inputs.dispenser, inputs.conc, inputs.dosage].forEach(el =>
        el.addEventListener('input', calculate)
    );

    function estimateWater() {
        if (!inputs.num.value || !inputs.weight.value) return;
        let base = inputs.num.value * inputs.weight.value * 0.1;
        if (inputs.temp.value === 'hot') base *= 1.5;
        switch (inputs.waste.value) {
            case 'low': base *= 1.1; break;
            case 'mid': base *= 1.2; break;
            case 'high': base *= 1.4; break;
        }
        inputs.water.value = Math.round(base);
        calculate();
    }

    let calcTimeout;
    function calculate() {
        clearTimeout(calcTimeout);
        calcTimeout = setTimeout(() => {
            const v = {
                num: +inputs.num.value || 0,
                weight: +inputs.weight.value || 0,
                dosage: +inputs.dosage.value || 0,
                conc: +inputs.conc.value || 0,
                water: +inputs.water.value || 0,
                dispenser: +inputs.dispenser.value || 0
            };

            if (v.num <= 0 || v.weight <= 0 || v.dosage <= 0 || v.conc <= 0 || v.water <= 0 || v.dispenser <= 0) {
                outputs.result.textContent = '请完整填写所有必要参数';
                if (outputs.bucketLabel) outputs.bucketLabel.classList.remove('visible');
                return;
            }

            const productGr = Math.round(v.num * v.weight * v.dosage / (v.conc * 10));
            const stockL = v.water * v.dispenser / 100;
            const stockDisplay = stockL % 1 === 0 ? stockL.toFixed(0) : stockL.toFixed(1);

            outputs.product.textContent = productGr + ' g';
            outputs.stock.textContent = stockDisplay + ' l';
            outputs.result.textContent = `生产一天所需的原液我们需要将 ${productGr} g 或 ml 的商业药品加入到 ${stockDisplay} l 的稀释用水中。`;

            if (outputs.bucketLabel) outputs.bucketLabel.classList.add('visible');
        }, 300);
    }

    document.querySelectorAll('.tab').forEach(tab => {
        tab.onclick = () => {
            document.querySelectorAll('.tab, .tab-content').forEach(el => el.classList.remove('active'));
            tab.classList.add('active');
            $(tab.dataset.tab).classList.add('active');
        };
    });

    resetAll();
</script>
</body>
</html>
