<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>饮水加药计算器</title>
<style>
    :root {
        --pos-water-top: 20%;
        --pos-water-left: 6%;
        --pos-dispenser-top: 5%;
        --pos-dispenser-left: 38%;
        --pos-conc-top: 22%;
        --pos-conc-left: 35%;
        --pos-dosage-top: 35%;
        --pos-dosage-left: 35%;
        --pos-num-top: 48%;
        --pos-num-right: 12%;
        --pos-weight-top: 56%;
        --pos-weight-right: 12%;
        --pos-env-top: 33%;
        --pos-env-left: 8%;
        --default-label-width: 80px;
        --default-input-width: 80px;
        --vertical-label-font-size: 14px;
    }
    body {
        margin: 0;
        padding: 20px;
        background: #f0f8ff;
        font-family: Arial, Helvetica, sans-serif;
        min-height: 100vh;
        box-sizing: border-box;
    }
    .tabs {
        display: flex;
        justify-content: center;
        border-bottom: 2px solid #0066cc;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 10px;
    }
    .tab {
        padding: 8px 25px;
        cursor: pointer;
        font-weight: bold;
        color: #0066cc;
        background: #e6f0ff;
        border: 2px solid #0066cc;
        border-radius: 20px;
        transition: all 0.3s ease;
    }
    .tab.active {
        background: #0066cc;
        color: #fff;
    }
    .tab:hover {
        background: #d0e4ff;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0,102,204,0.2);
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .container {
        max-width: 1200px;
        margin: 0 auto;
        position: relative;
    }
    .diagram {
        position: relative;
        min-height: 700px;
        background: url('https://raw.githubusercontent.com/Vopell/wellhope/main/image.jpg') no-repeat center center;
        background-size: contain;
    }
    /* 输入组通用样式 */
    .input-group, .input-group-vertical, .env-group {
        background: rgba(255,255,255,0.9);
        padding: 12px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .input-group {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
    }
    .input-group label {
        font-weight: bold;
        white-space: nowrap;
        min-width: var(--default-label-width);
    }
    .input-group input, .input-group select {
        flex: 1;
        height: 30px;
        padding: 4px 8px;
        font-size: 14px;
        border: 1px solid #999;
        border-radius: 4px;
        box-sizing: border-box;
    }
    .input-group .unit {
        font-weight: bold;
        color: #333;
        min-width: 40px;
    }
    .input-group-vertical {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    .input-group-vertical label {
        font-weight: bold;
        text-align: center;
        font-size: var(--vertical-label-font-size);
    }
    .input-group-vertical .input-wrapper {
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: center;
    }
    .input-group-vertical .input-wrapper input {
        flex: 1;
        height: 30px;
        padding: 4px 8px;
    }
    input.enabled, select.enabled { background: #ffff99; }
    input.disabled, select.disabled { background: #ffd6d6 !important; color: #666; pointer-events: none; }
    .env-group {
        display: none;
        flex-direction: column;
        gap: 18px;
    }
    .env-group .input-group {
        justify-content: space-between;
    }
    .env-group select { width: 120px; }
    /* 桌面端绝对定位（保持您原来的完美布局） */
    #box-water { position: absolute; top: var(--pos-water-top); left: var(--pos-water-left); width: 240px; }
    #box-dispenser { position: absolute; top: var(--pos-dispenser-top); left: var(--pos-dispenser-left); width: 220px; }
    #box-conc { position: absolute; top: var(--pos-conc-top); left: var(--pos-conc-left); width: 220px; }
    #box-dosage { position: absolute; top: var(--pos-dosage-top); left: var(--pos-dosage-left); width: 220px; }
    #box-num { position: absolute; top: var(--pos-num-top); right: var(--pos-num-right); width: 220px; }
    #box-weight { position: absolute; top: var(--pos-weight-top); right: var(--pos-weight-right); width: 220px; }
    .env-group { position: absolute; top: var(--pos-env-top); left: var(--pos-env-left); width: 260px; }
    .reset-btn {
        position: absolute;
        top: 2%;
        left: 7%;
        padding: 12px 28px;
        background: linear-gradient(135deg, #ffa500, #ff8c00);
        color: #fff;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        z-index: 20;
        box-shadow: 0 6px 18px rgba(255, 140, 0, 0.4);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .reset-btn::before { content: "↻"; font-size: 18px; }
    .reset-btn:hover {
        background: #e67e00;
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(255, 140, 0, 0.6);
    }
    .bucket-label {
        position: absolute;
        top: 60%;
        left: 30%;
        text-align: center;
        font-weight: bold;
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.5s ease;
    }
    .bucket-label.visible { visibility: visible; opacity: 1; }
    #product { font-size: 30px; color: #d00; margin-bottom: 50px; }
    #stock { font-size: 30px; color: #0066cc; }
    .result {
        width: calc(100% - 40px);
        max-width: 1046px;
        margin: 0 auto;
        padding: 24px;
        background: rgba(0, 102, 204, 0.9);
        color: #fff;
        font-size: 24px;
        text-align: center;
        border-radius: 8px;
        box-sizing: border-box;
        position: absolute;
        left: 50%;
        bottom: 20px;
        transform: translateX(-50%);
        z-index: 15;
    }
    .instructions {
        max-width: 1000px;
        margin: 0 auto;
        background: #fff;
        border: 1px solid #ccc;
        padding: 30px;
        line-height: 1.8;
        border-radius: 8px;
        font-size: 16px;
    }
    /* 移动端响应式布局 */
    @media (max-width: 768px) {
        .diagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 100px 20px 160px;
            min-height: auto;
        }
        .input-group, .input-group-vertical, .env-group {
            position: static;
            width: 100%;
            max-width: 340px;
        }
        .env-group { display: flex; }
        .reset-btn {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 24px;
            font-size: 15px;
        }
        .result {
            bottom: 10px;
            font-size: 20px;
            padding: 18px;
            width: calc(100% - 20px);
        }
        .bucket-label {
            position: static;
            transform: none;
            margin: 20px 0;
        }
    }
</style>
</head>
<body>
<div class="tabs">
    <div class="tab active" data-tab="sim">模拟</div>
    <div class="tab" data-tab="info">说明</div>
</div>

<div class="tab-content active" id="sim">
    <div class="container">
        <div class="diagram">
            <button class="reset-btn" onclick="resetAll()">清零</button>

            <div class="input-group-vertical" id="box-water">
                <label for="water">总耗水量</label>
                <div class="input-wrapper">
                    <input type="number" id="water" min="0" class="disabled">
                    <span class="unit">升/天</span>
                </div>
            </div>

            <div class="env-group" id="env-group">
                <div class="input-group">
                    <label for="temp">温度</label>
                    <select id="temp">
                        <option value="normal">温度适中</option>
                        <option value="hot">炎热</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="waste">浪费水量</label>
                    <select id="waste">
                        <option value="none">无浪费</option>
                        <option value="low">低</option>
                        <option value="mid">中</option>
                        <option value="high">高</option>
                    </select>
                </div>
            </div>

            <div class="input-group-vertical" id="box-dispenser">
                <label for="dispenser">加药器设置</label>
                <div class="input-wrapper">
                    <input type="number" id="dispenser" min="0" max="100" step="0.1" class="disabled">
                    <span class="unit">%</span>
                </div>
            </div>

            <div class="input-group-vertical" id="box-conc">
                <label for="conc">产品有效浓度</label>
                <div class="input-wrapper">
                    <input type="number" id="conc" min="0" max="100" step="0.1" class="disabled">
                    <span class="unit">%</span>
                </div>
            </div>

            <div class="input-group-vertical" id="box-dosage">
                <label for="dosage">给药剂量</label>
                <div class="input-wrapper">
                    <input type="number" id="dosage" min="0" step="0.1" class="disabled">
                    <span class="unit">mg/kg</span>
                </div>
            </div>

            <div class="input-group" id="box-num">
                <label for="num">牲畜数量</label>
                <input type="number" id="num" min="1">
                <span class="unit">头</span>
            </div>

            <div class="input-group" id="box-weight">
                <label for="weight">平均体重</label>
                <input type="number" id="weight" min="0" step="0.1" class="disabled">
                <span class="unit">kg</span>
            </div>

            <div class="bucket-label" id="bucket-label">
                <div id="product"></div>
                <div id="stock"></div>
            </div>
        </div>

        <div class="result" id="result">请按顺序输入参数</div>
    </div>
</div>

<div class="tab-content" id="info">
    <div class="instructions">
        该计算器用于计算通过加药器向饮水中加药时所需加入的药量。<br><br>
        计算原液使用量时，在相应的方格中输入数据，黄色背景表示可输入。<br><br>
        如果您不清楚畜群具体的饮水消耗量，可以只填写牲畜数量和平均活体重，系统会根据标准估算饮水量（可进一步通过“温度”和“浪费水量”选项调整估算值）。<br><br>
        根据第一天实际原液消耗量，即可反推真实饮水量并优化后续配药。
    </div>
</div>

<script>
    const $ = id => document.getElementById(id);
    const inputs = {
        num: $('num'),
        weight: $('weight'),
        water: $('water'),
        temp: $('temp'),
        waste: $('waste'),
        dispenser: $('dispenser'),
        conc: $('conc'),
        dosage: $('dosage')
    };
    const outputs = {
        product: $('product'),
        stock: $('stock'),
        result: $('result'),
        bucketLabel: $('bucket-label')
    };

    function setEnabled(el, enabled) {
        el.disabled = !enabled;
        if (enabled) {
            el.classList.remove('disabled');
            el.classList.add('enabled');
        } else {
            el.classList.remove('enabled');
            el.classList.add('disabled');
        }
    }

    function resetAll() {
        Object.values(inputs).forEach(el => {
            if (el.tagName === 'SELECT') el.selectedIndex = 0;
            else el.value = '';
            setEnabled(el, false);
        });
        setEnabled(inputs.num, true);
        $('env-group').style.display = 'none';
        outputs.product.textContent = '';
        outputs.stock.textContent = '';
        if (outputs.bucketLabel) outputs.bucketLabel.classList.remove('visible');
        outputs.result.textContent = '请按顺序输入参数';
    }

    ['num', 'weight', 'water', 'dispenser', 'conc', 'dosage'].forEach(key => {
        inputs[key].addEventListener('input', function () {
            this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\./g, '$1');
        });
    });

    inputs.num.addEventListener('input', () => {
        setEnabled(inputs.weight, inputs.num.value > 0);
        if (inputs.weight.value > 0) estimateWater();
    });

    inputs.weight.addEventListener('input', () => {
        if (inputs.weight.value > 0) {
            [inputs.water, inputs.dispenser, inputs.conc, inputs.dosage].forEach(el => setEnabled(el, true));
            $('env-group').style.display = 'flex';
            setEnabled(inputs.temp, true);
            setEnabled(inputs.waste, true);
            inputs.temp.selectedIndex = 0;
            inputs.waste.selectedIndex = 0;
            estimateWater();
        }
    });

    inputs.temp.addEventListener('change', () => { estimateWater(); calculate(); });
    inputs.waste.addEventListener('change', () => { estimateWater(); calculate(); });

    [inputs.water, inputs.dispenser, inputs.conc, inputs.dosage].forEach(el => el.addEventListener('input', calculate));

    function estimateWater() {
        if (!inputs.num.value || !inputs.weight.value) return;
        let base = inputs.num.value * inputs.weight.value * 0.1;
        if (inputs.temp.value === 'hot') base *= 1.5;
        switch (inputs.waste.value) {
            case 'low': base *= 1.1; break;
            case 'mid': base *= 1.2; break;
            case 'high': base *= 1.4; break;
        }
        inputs.water.value = Math.round(base);
        calculate();
    }

    let calcTimeout;
    function calculate() {
        clearTimeout(calcTimeout);
        calcTimeout = setTimeout(() => {
            const v = {
                num: +inputs.num.value || 0,
                weight: +inputs.weight.value || 0,
                dosage: +inputs.dosage.value || 0,
                conc: +inputs.conc.value || 0,
                water: +inputs.water.value || 0,
                dispenser: +inputs.dispenser.value || 0
            };

            if (v.num <= 0 || v.weight <= 0 || v.dosage <= 0 || v.conc <= 0 || v.water <= 0 || v.dispenser <= 0) {
                outputs.result.textContent = '请完整填写所有必要参数';
                if (outputs.bucketLabel) outputs.bucketLabel.classList.remove('visible');
                return;
            }

            const productGr = Math.round(v.num * v.weight * v.dosage / (v.conc * 10));
            const stockL = v.water * v.dispenser / 100;
            const stockDisplay = stockL % 1 === 0 ? stockL.toFixed(0) : stockL.toFixed(1);

            outputs.product.textContent = productGr + ' g';
            outputs.stock.textContent = stockDisplay + ' l';
            outputs.result.textContent = `生产一天所需的原液我们需要将 ${productGr} g 或 ml 的商业药品加入到 ${stockDisplay} l 的稀释用水中。`;

            if (outputs.bucketLabel) outputs.bucketLabel.classList.add('visible');
        }, 300);
    }

    document.querySelectorAll('.tab').forEach(tab => {
        tab.onclick = () => {
            document.querySelectorAll('.tab, .tab-content').forEach(el => el.classList.remove('active'));
            tab.classList.add('active');
            $(tab.dataset.tab).classList.add('active');
        };
    });

    resetAll();
</script>
</body>
</html>
